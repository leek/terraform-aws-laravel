index index.php index.html index.htm;

# Increase upload size limit
client_max_body_size 32M;

# Set real IP from ALB
real_ip_header X-Forwarded-For;
set_real_ip_from 10.0.0.0/8;
real_ip_recursive on;

# Handle Laravel routes
location / {
    try_files $uri $uri/ /index.php?$query_string;
}

# Handle PHP files
location ~ \.php$ {
    fastcgi_pass 127.0.0.1:9000;
    fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
    include fastcgi_params;
    fastcgi_hide_header X-Powered-By;

    # Pass ALB headers to PHP/Laravel
    fastcgi_param HTTP_X_FORWARDED_FOR $http_x_forwarded_for;
    fastcgi_param HTTP_X_FORWARDED_PROTO $http_x_forwarded_proto;
    fastcgi_param HTTP_X_FORWARDED_PORT $http_x_forwarded_port;

    # Set HTTPS based on X-Forwarded-Proto header from ALB
    fastcgi_param HTTPS $http_x_forwarded_proto if_not_empty;
}
